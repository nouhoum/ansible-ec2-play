#!/usr/bin/env python

import os
import subprocess
import simplejson as json
import sys

def help():
  sys.exit('''Returns the run status of the RDS instances with the specified database instanceId.

Usage: %s instanceIds

One value is returned for each instanceId.
Returned values can be: available, backing-up, creating, deleting, failed, incompatible-network, incompatible-option-group, incompatible-parameters, incompatible-restore, modifying, rebooting, renaming, resetting-master-credentials and storage-full, ''' % os.path.basename(sys.argv[0]))

if len(sys.argv)<2:
  help()

for instanceId in sys.argv[1:]:
  try:
    p = subprocess.Popen("aws rds describe-db-instances --db-instance-identifier {0}".format(instanceId), stdout=subprocess.PIPE, shell=True)
    (output, err) = p.communicate()
    instances = json.loads(output)['DBInstances']
  except Exception as ex:
    pass
  else:
    space = ""
    for instance in instances:
      print "%s%s" % (space, instance['DBInstanceStatus'])
      space = " "
